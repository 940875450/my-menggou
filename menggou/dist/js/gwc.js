"use strict";require(["config"],function(){require(["jquery","template","url","header","cookie"],function(h,u,n,e,c){function p(){var t=0;h(".gwc-ck").each(function(){if(h(this).is(":checked")){var e=parseInt(h(this).siblings(".gwc-count").children(".gwc-change").val()),c=parseInt(h(this).siblings(".gwc-jg").children("i").children(".danjia").html());t+=e*c}}),h("#ele_all").html(t+".00")}function d(){var e=h(".gwc-ck").length;h(".select-all").on("click",function(){e=h(".select-all").is(":checked")?(h(".gwc-ck").prop("checked",!0),h(".gwc-ck").length):(h(".gwc-ck").attr("checked",!1),0),p()}),h(".gwc-ck").on("click",function(){h(this).is(":checked")?e++:e--,e==h(".gwc-ck").length?h(".select-all").prop("checked",!0):h(".select-all").prop("checked",!1),p()}),h(".gwc-del").on("click",function(){h.ajax({url:n.url+"/php/gwcdel.php",type:"GET",dataType:"json",data:{userid:t,eleid:h(this).attr("data-id")},success:function(e){e.code?confirm("真的要从购物车删除商品么？")&&a():alert("删除失败！")}})}),h(".gwc-remove").on("click",function(){confirm("确定要清空所有购物车么？")&&h.ajax({url:n.url+"/php/gwcremove.php",type:"GET",dataType:"json",data:{userid:t},success:function(e){if(e.code){var c=u("gwcnone");h("#gwcshop").html(c)}else alert("清空失败！！！")}})}),h(".gwc-change").on("blur",function(){h.ajax({url:n.url+"/php/gwcchange.php",type:"GET",dataType:"json",data:{userid:t,eleid:h(this).attr("data-id"),elenum:h(this).val()},success:function(e){e.code?a():alert("添加失败！")}})}),h(".gwc-toele").on("click",function(){h.cookie("userid",h(this).attr("data-id"),{expires:30,path:"/"})})}var t;function a(){h.ajax({url:n.url+"/php/gwcshow.php",type:"GET",dataType:"json",data:{userid:t},success:function(e){if(console.log(""==e),""!=e)for(var i=[],s=0,o=e,r=0,c=0;c<e.length;c++)h.ajax({type:"get",url:n.url+"/php/element.php",dataType:"json",data:{userid:e[c].eleid},success:function(e){if(i.push(e[0]),++s==o.length)for(var c=0;c<o.length;c++)if(i[c].elenum=o[c].elenum,++r==o.length){for(var t=1;t<i.length;t++)for(var n=0;n<i.length-t;n++)if(parseInt(i[n].id)>=parseInt(i[n+1].id)){var a=i[n+1];i[n+1]=i[n],i[n]=a}var l=u("gwcShop",{arr:i});h("#gwcshop").html(l),d(),p()}}});else{var t=u("gwcnone");h("#gwcshop").html(t)}}})}if(e.init(n,u,c),h(".gwc-chose ul li").on("click",function(){h(".gwc-chose span p").html(h(this).html())}),null!=h.cookie("useName"))h.ajax({url:n.url+"/php/list.php",type:"GET",dataType:"json",data:{user:h.cookie("useName")},success:function(e){t=e[0].username,a()}});else{var l=u("gwcnone");h("#gwcshop").html(l)}})});